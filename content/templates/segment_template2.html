<script type="text/html" id="segment-template">

<div class="row" data-bind="visible: formErrors().length > 0">
    <div class="large-12 columns">
    <div class="form-error">
        <h6 class="heading"><span style="color:#f04124" class="icon-spam"> </span>Form Errors</h6>
        <ul class="square" data-bind="foreach:formErrors">
            <li data-bind="html: $data"></li>
        </ul>
        </div>
    </div>
</div>

<div class="row">
    <div class="large-12 columns" style="min-width:300px">
        <!-- ko template: {name: 'selection-template', data: selectionGroup} -->
        <!-- /ko -->
    </div>
</div>

<div class="row">
    <div class="medium-6 columns">
            <label>Select Chart Type
                <select data-bind="options: drata.global.chartTypes, value : chartType, optionsCaption: 'select chart Type'">
                </select>
            </label>
        <!-- ko if: chartType()-->
            <!-- ko template: dataGroupTemplate -->
            <!-- /ko -->
        <!-- /ko -->
    </div>
    <div class="medium-6 columns">
        
            <!-- ko template: { name: 'datafilter-template', data: dataFilter, afterRender: dataFilter.afterRender } -->
            <!-- /ko -->
        
    </div>
</div>


<div class="row">
    <div class="small-12 columns" data-bind="with: conditionGroup">
        <fieldset>
            <legend>Conditions</legend>
            <div class="keystroke expression" data-bind="visible: conditions().length>0, html:expression"></div>
            <div class="row">
                <div class="small-12 columns conditioncombo">
                    <!-- ko template: { name : 'condition-group-template', data: currentBinding, afterRender: afterRender, beforeRemove : beforeLeave } -->
                    <!-- /ko -->
                </div>
            </div>
        </fieldset>
    </div>
</div>
</script>
<script type="text/html" id="datafilter-template">
    
    <div class="row">
        <div class="small-12 columns">
            <div class="row">
                <div class="small-12 columns">
                    <label>Date Property
                        <div data-bind="comboBox :{selectedValue: dateProp, options: $parent.dateProperties,optionsCaption:'choose Property',allowCustom:false}">
                        </div>
                    </label>
                    <input type="radio" data-bind="value: 'dynamic', checked: intervalType" name="datafilter" id="rbInterval" /><label for="rbInterval">Dynamic Interval</label>
                    <input type="radio" data-bind="value: 'static', checked: intervalType" name="datafilter" id="rbRange" /><label for="rbRange">Specify Date Range</label>
                </div>
            </div>
            <div class="row" data-bind="visible:intervalType() === 'dynamic'">
                <div class="medium-6 small-12 columns">
                    <select data-bind="options: drata.global.timeframes,optionsCaption: 'Interval',value: intervalKind">
                    </select>
                </div>
                <div class="medium-6 small-12 columns">
                    <div style="margin:.7rem" id="myslider"></div>
                </div>
            </div>
            <div class="row" data-bind="visible:intervalType() === 'static'">
                <div class="small-6 columns">
                    <div class="row collapse">
                        <div class="small-10 columns">
                            <input type="text" id="from" data-bind="value:minDate" placeholder="Start Date"></input>
                        </div>
                        <div class="small-2 columns" data-bind="click: showDatePicker.bind($data, 'start')">
                            <span class="postfix"><i class="general foundicon-calendar"></i></span>
                        </div>
                    </div>
                </div>
                <div class="small-6 columns">
                    <div class="row collapse">
                        <div class="small-10 columns">
                            <input type="text" id="to" data-bind=", value:maxDate" placeholder="End Date"></input>
                        </div>
                        <div class="small-2 columns" data-bind="click: showDatePicker.bind($data, 'end')">
                            <span class="postfix"><i class="general foundicon-calendar"></i></span>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="small-12 columns">
            <div class="keystroke expression" data-bind="html:expression"></div>
        </div>
    </div>
</script>
<script type="text/html" id="selection-template">
<div class="row">
    <div class="large-12 columns">
        <fieldset>
            <legend>Selections</legend>

            <div class="keystroke expression" data-bind="html:$data.expression()"></div>
            <div class="row">
                <div class="small-12 columns">
                    <div class="clearfix" style="position:relative">
                        <!-- ko foreach: items, afterAdd: afterAdd, beforeRemove: beforeRemove -->
                        <div class="left" style="margin-right:2rem">
                            <!-- ko template: {name: 'selectionGroupTemplate'} -->
                            <!-- /ko -->
                        </div>
                        <!-- /ko -->
                        <a class="left" style="line-height:2rem" data-bind="click: addItem"><i class="icon-plus"></i> Add</a>
                    </div>
                </div>
            </div>
            
        </fieldset>
    </div>
</div>
</script>

<script type="text/html" id="comp-datagroup-template">
    <label>
                <input type="checkbox" data-bind="checked:hasGrouping" />
                &nbsp;Groupby
    <div class="row">
        <div class="columns" data-bind="css: {'small-9' : groupByIntervalType() !== 'string','small-12' : groupByIntervalType() === 'string' || groupByIntervalType() === 'unknown'}, ddComboBox :{enabled: hasGrouping, selectedPrefix: groupByIntervalType , prefixOptions: drata.global.propertyTypes,selectedValue: groupByProp, options:$parent.properties,optionsCaption:'Select GroupBy', allowCustom:false}">
        </div>
        <!-- ko if: hasGrouping() && groupByIntervalType() !== 'string' && groupByIntervalType() !== 'unknown'  -->
        <div class="small-3 columns" data-bind="comboBox:{selectedValue: groupByInterval, options: groupByIntervalOptions, optionsCaption: 'Interval'}">
        </div>
        <!-- /ko -->
    </div>
    </label>
    <!-- ko if:hasGrouping -->
    <label>
        <input type="checkbox" data-bind="checked:hasDivideBy" /> Slice by
        <div class="row">
            <div class="columns" data-bind="css: {'small-9' : divideByIntervalType() !== 'string','small-12' : divideByIntervalType() === 'string' || divideByIntervalType() === 'unknown'}, ddComboBox :{enabled: hasDivideBy, selectedPrefix: divideByIntervalType, prefixOptions: drata.global.propertyTypes,selectedValue: divideByProp, options:$parent.properties,optionsCaption:'Slice By', allowCustom:false}">
            </div>
            <!-- ko if: hasDivideBy() && divideByIntervalType() !== 'string' && divideByIntervalType() !== 'unknown'  -->
                <div class="small-3 columns" data-bind="comboBox:{selectedValue: divideByInterval, options: divideByIntervalOptions, optionsCaption: 'Interval'}">
                </div>
            <!-- /ko -->                            
        </div>
    </label>
    <!-- /ko -->
</script>
<script type="text/html" id="track-datagroup-template">
    <label>Aggregate with
            <div data-bind="ddComboBox :{selectedPrefix: xAxisType , prefixOptions: drata.global.xAxisTypes,selectedValue: xAxisProp, options:properties,optionsCaption:'x Axis', allowCustom:false}">
            </div>
    </label>
    <div class="row">
        <div class="small-6 columns">
            <label>
                <input type="checkbox" data-bind="checked:hasGrouping" />
                &nbsp;Split by
                <select data-bind="enable: hasGrouping, value:groupByProp, options:$parent.nonDateProperties, optionsCaption : 'Select GroupBy'">
                </select>
            </label>
        </div>
        <div class="small-6 columns">
            <label>
                <input type="checkbox" data-bind="checked:timeseries" />
                        Interval
                <div data-bind="comboBox:{enabled:timeseries, selectedValue: timeseriesInterval, options: intervalOptions, optionsCaption: 'Interval'}">
                    
                </div>
            </label>
        </div>
    </div>
    
</script>

<script type="text/html" id="selectionGroupTemplate">
    <div>
        <div class="row" style="position:relative" data-bind="attr:{style: (renderType === 'topCondition')?'position:relative' : 'position:relative;width:270px'}">
            <!-- ko if: renderType === 'topSelection' -->
                <div class="small-12 columns">
                   <div data-bind="ddComboBox :{selectedPrefix: groupBy , prefixOptions: drata.global.groupingOptions ,selectedValue: selectedProp, options: segmentProcessor.segment.properties,optionsCaption:'choose Property',enabled: hideComplex}">
                    </div>
                    
                    <!-- ko if: isComplex() -->
                    <span class="complex-overlay top-selection" data-bind="click: toggleComplex">
                        <span data-bind="html : aliasName() ? aliasName() : 'Complex Selection. <em> edit</em>'"></span>
                    </span>
                     <!-- /ko -->
                </div>
                <i class="general complexcombo-toggle" data-bind="css:{'foundicon-plus': !showComplex() , 'foundicon-minus' : showComplex}, click:toggleComplex">
                </i>

            <!-- /ko -->
            <!-- ko if: renderType === 'topCondition' -->
                <!-- ko if: !isComplex() -->
                
                 <div class="small-12 columns" data-bind="comboBox :{selectedValue: selectedProp, options: segmentProcessor.segment.properties,optionsCaption:'choose Property',enabled: hideComplex}">
                </div>
                <i class="general complexcombo-toggle" data-bind="css:{'foundicon-plus': !showComplex() , 'foundicon-minus' : showComplex}, click:toggleComplex" style="right:20px">
                </i>
                 <!-- /ko -->
                <!-- ko if: isComplex() -->
                    <div class="small-12 columns" >
                        <div class="complex-overlay" data-bind="click: toggleComplex">
                           <span data-bind="html : aliasName() ? aliasName() : 'Complex Selection. <em> edit</em>'"></span>
                        </div>
                    </div>
                <!-- /ko -->

            <!-- /ko -->
            <!-- ko if: renderType === 'childSelection' -->
                <div class="small-3 columns" data-bind="visible: $index() > 0">
                    <select data-bind="options:drata.global.arithmeticOperations, value:logic"></select>
                </div>
                <!-- ko if: !isComplex() -->
                <div class="small-8 columns" data-bind="css:{'small-offset-3': $index() === 0},comboBox :{selectedValue: selectedProp, options: segmentProcessor.segment.properties,optionsCaption:'choose Property',enabled: hideComplex}">
                </div>
                <i class="general complexcombo-toggle" data-bind="css:{'foundicon-plus': !showComplex() , 'foundicon-minus' : showComplex}, click:toggleComplex">
                </i>
                <!-- /ko -->
                <!-- ko if: isComplex() -->
                    <div class="small-8 columns" data-bind="css:{'small-offset-3': $index() === 0}">
                        <div data-alert class="complex-overlay" data-bind="click: toggleComplex">
                           <span data-bind="html : aliasName() ? aliasName() : 'Complex Selection. <em> edit</em>'"></span>
                        </div>
                    </div>
                <!-- /ko -->
            <!-- /ko -->
            <!-- ko if:renderType !== 'topCondition' -->
            <i class="icon-close selection-action alert" data-bind="click: function(vm){if(renderType === 'childSelection'){$parent.removeSelection(vm)}else{$parent.removeItem(vm)}} ">
            </i>
           <!-- /ko -->
        </div>
        <!-- ko if: showPercentChange -->
            <div class="clearfix" style="position:relative; top:-1rem">
            <div class="left">
            <label><input type="checkbox" data-bind="checked: perc"></input> % Chng</label>
            </div>
            </div>
        <!-- /ko -->     
            
        <div id="complexWrapper" class="complexcombo" data-bind="slideVisible: showComplex()">
            <div class="row">
                <div class="large-12 columns">
                    <div class="row">
                        <div class="small-8 columns">
                             <h6>Complex Selection</h6>
                        </div>
                    </div>
                   
            <input type="text" data-bind="visible: level === 1, value:aliasName" placeholder="Alias Name"></input>
                </div>
            </div>
            <!-- ko template: {name: 'selectionGroupTemplate', foreach: selections, afterAdd: afterAdd, beforeRemove: beforeRemove} -->
            <!-- /ko -->
            <div class="row">
                <div class="small-4 columns">
                    <a class="button tiny success" data-bind="click:addSelection"><i class="general foundicon-plus"></i>&nbsp;Add</a>
                </div>
                <div class="small-4 columns">
                     <a class="button tiny primary" data-bind="click:done"><i class="general foundicon-plus"></i>&nbsp;Done</a>
                </div>
                <div class="small-4 columns">
                     <a class="button tiny alert" data-bind="click:clearGroups"><i class="general foundicon-remove"></i>&nbsp;Clear</a>
                </div>
                
            </div>
        </div>
        </div>
    </script>

<script type="text/html" id="condition-group-template">
    <div id="conditionWrapper" class="condition-wrapper">
    
    <div class="row">
        <div class="small-12 columns">
            <!-- ko template: {name: 'condition-template', foreach: conditions, afterAdd: afterAdd, beforeRemove: beforeRemove} -->
            <!-- /ko -->

            <div data-alert class="alert-box secondary" data-bind="visible:conditions().length === 0">
                You may add simple condition (Ex: a > b) or, a complex condition (a > b <em>or</em> (b < c <em>and</em> c = d))
            </div>

            <div class="row">
                <div class="large-12 columns">
                   <a class="button left tiny secondary" style="margin-right:10px" data-bind="click:$parent.goBackTopLevel, visible:$parent.trace().length > 0"> <i class="general foundicon-left-arrow"></i>&nbsp;Top Level</a>
                    <a class="button left tiny primary" style="margin-right:10px" data-bind="visible:$parent.trace().length > 0,click:$parent.goback"><i class="general foundicon-left-arrow"></i>&nbsp;Done</a>
                     <a class="button left tiny alert" style="margin-right:10px" data-bind="click:clear"><i class="general foundicon-remove"></i>&nbsp;Clear</a>
                    <a class="button left tiny success" style="margin-right:10px" data-bind="click:addComplexCondition"><i class="general foundicon-plus"></i>&nbsp;Complex</a>
                    <a class="button left tiny success" style="margin-right:10px" data-bind="click:addCondition"><i class="general foundicon-plus"></i>&nbsp;Simple</a>
                </div>
            </div>
        </div>
    </div>
    </div>
</script>

<script type="text/html" id="condition-template">
    <div class="row">
        <div class="small-2 columns" data-bind="visible:$index() > 0">
            <select data-bind="options:drata.global.logics, value:logic"></select>
        </div>
        <!-- ko if: !isComplex() -->
        <div class="small-3 columns"  data-bind="css : {'small-offset-2': $index() === 0},template: {name: 'selectionGroupTemplate', data: selection}">
        </div>
        <div class="small-2 columns">
            <select data-bind="options:availableOperations, value:operation"></select>
        </div>
        <div class="small-3 columns" data-bind="visible: operation() !== 'exists'">
            <div data-bind=" ddComboBox :{selectedPrefix: valType , prefixOptions: drata.global.propertyTypes ,selectedValue: value, options:availableValues,optionsCaption:'value'}">
                </div>
            <!-- <input type="text" data-bind="value:value, visible: operation() !== 'exists'" placeholder="value"></input> -->
        </div>
        <!-- /ko -->
        <!-- ko if: isComplex -->
        <div class="small-8 columns" data-bind="css : {'small-offset-2': $index() === 0},click:expand">
            <div data-alert class="complex-overlay" data-bind="html: complexConditionSummary">
            </div>
        </div>
        <!-- /ko -->
        <div class="small-2 columns small-centered">
            <i class="icon-plus condition-action success" data-bind="click:expand"></i>
            <i class="icon-close condition-action alert" data-bind="click: $parent.removeCondition"></i>
        </div>
    </div>
</script>

