<!DOCTYPE html>
<meta charset="utf-8">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Drata</title>

    <link rel="stylesheet" type="text/css" href="content/style/core/normalize.css" />
    <link rel="stylesheet" type="text/css" href="content/style/core/foundation.css" />
    <link rel="stylesheet" type="text/css" href="content/style/dashboard.css" />
    <link rel="stylesheet" type="text/css" href="content/style/line-graph.css" />
    <link rel="stylesheet" type="text/css" href="content/style/core/general_foundicons.css" />
    <link rel="stylesheet" type="text/css" href="content/nvd3/nv.d3.css" />
    <style>
        .logic-text {
            position: relative;
            top: .4rem;
            left: 1.5rem;
            display: inline;
        }

        .logic-selection {
            display: none;
            max-width: 55px;
            margin-left: 0.8rem;
        }

        .logic-wrapper {
            border-bottom: 1px solid #ddd;
        }

        .row .columns.logic-toggler {
            position: absolute;
            width: 80px;
            z-index: 999;
        }

        .row .columns.operation-group {
            padding-left: 80px;
        }

        .logic-toggler:hover .logic-wrapper {
            border: none;
        }

        .logic-toggler:hover .logic-text {
            display: none;
        }

        .logic-toggler:hover .logic-selection {
            display: block;
        }

        .remove-group {
            color: #ff0000;
            vertical-align: middle;
        }

        .remove-condition {
            color: #ff0000;
            position: relative;
            top: .4rem;
            left: .5rem;
        }

        .vertical-bg {
            background-image: url('content/images/border_1x1.png');
            background-repeat: repeat-x;
            background-position: 0 20px;
        }

        .condition-view {
            position: relative;
            top: .5rem;
            margin-bottom: 1.5rem;
        }

        #previewgraph {
            height: 300px;
        }

        .mymodal-wrapper.showme {
            opacity: 1;
            visibility: visible;
        }

        .mymodal-wrapper {
            position: absolute;
            /*right: -103%;
            left: 103%;*/
            visibility: hidden;
            transition: visibility .1s, opacity .5s linear;
            height: auto;
            /*transition: all 1s;*/
            background-color: rgba(0, 0, 0, 0.4);
            top: 2.8rem;
            padding: 1.3rem 0;
            width: 100%;
            opacity: 0;
        }

        /*#graphBuilder:before, #graphBuilder:after {
            content: " ";
        }*/

        .mymodal-inner {
            width: 70%;
            margin: 0 auto;
            background-color: #fff;
        }
        .mymodal-wrapper.chart-type{
            height:400px;
            z-index: 9;
            top: 0;
        }
        .mymodal-wrapper.chart-type .mymodal-inner{
            top:33%;
        }
        svg.pie {
            width:auto;
            height:auto;
            display:inline;
        }

        ul.segment-type{
            text-align: center;
            padding-top:1.25rem;
        }
        .segment-type i {
            font-size: 2rem;
        }
        .segment-type p{
            margin-bottom: 0;
        }
        @media only screen and (max-width: 64.063em) {
            .segment-processor-inner {
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <nav class="top-bar dashboard" id="topbar" data-topbar style="margin-bottom:2rem">
        <ul class="title-area">
            <li class="name">
                <h1><a href="#">Drata</a></h1>
            </li>
            <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
        </ul>

        <section class="top-bar-section">
            <!-- Right Nav Section -->
            <ul class="right">
                <li class="divider"></li>
                <li class="has-form">
                    <a data-bind="click:addWidget" class="button success"><i class="general foundicon-plus"></i>&nbsp;Add Widget</a>
                </li>
                
            </ul>

            <!-- Left Nav Section -->
            <ul class="left">
            </ul>
        </section>
    </nav>
    <div class="row">
        <div id="dashboard" class="small-12 columns">
            <ul class="large-block-grid-3 small-block-grid-1 js-sortable" data-bind="template:{ name: 'widget-template',foreach:widgets, afterRender:loadWidget }">
            </ul>
        </div>
    </div>
    <div id="graphBuilder" class="mymodal-wrapper">
        <div class="mymodal-inner">
            <nav class="top-bar" id="topbar" data-topbar>
                <ul class="title-area">
                    <li class="name">
                        <h1><a href="#">Widget Processor</a></h1>
                    </li>
                    <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
                </ul>

                <section class="top-bar-section">
                    <!-- Right Nav Section -->
                    <ul class="right">
                        <li class="divider"></li>
                        <li class="has-form">
                            <a data-bind="click:preview" class="button">
                                <i class="general foundicon-graph"></i>&nbsp;Preview</a>
                        </li>
                        <li class="divider"></li>
                        <li class="has-form">
                            <a data-bind="click:notifyWidget" class="button success">
                                <i class="general foundicon-plus"></i>
                                <!-- ko text:addUpdateBtnText -->
                                <!-- /ko -->
                            </a>
                        </li>

                        <li class="divider"></li>
                        <li class="has-form">
                            <a data-bind="click:widgetCancel" class="button alert"><i class="general foundicon-remove"></i></a>
                        </li>
                    </ul>

                    <!-- Left Nav Section -->
                    <ul class="left">
                    </ul>
                </section>
            </nav>
            
            <div class="row">
                <div class="small-12 medium-4 large-6 columns">
                    <fieldset data-bind="visible:preview">
                        <legend>Preview</legend>
                        <div id="previewgraph">
                            <svg></svg>
                        </div>
                    </fieldset>
                    
                </div>
                <div class="small-12 medium-8 large-6 columns">
                    <fieldset>
                        <legend>Data Key</legend>
                        <div class="row">
                            <div class="small-4 columns">
                                <label class="right inline">Select Data Key</label>
                            </div>
                            <div class="small-8 columns">
                                <select data-bind="options:dataKeys, optionsCaption: 'choose key', value:selectedDataKey"></select>
                            </div>
                        </div>
                    </fieldset>
                    <!-- ko template: {name: 'segment-template', data: segment} -->
                    <!-- /ko -->
                </div>
            </div>


            <div class="row">
                <div class="small-12 columns">
                    <button class="button success" data-bind="click:preview">Preview</button>
                    &nbsp;
                    <button data-bind="click:notifyWidget,text:addUpdateBtnText"></button>
                    &nbsp;
                    <button class="button secondary" data-bind="click:widgetCancel">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/html" id="widget-template">
        <li>
            <div class="widget-wrapper">
                <nav class="top-bar secondary widget handle" id="topbar" data-topbar>
                    <ul class="title-area">
                        <li class="name">
                            <h1><a data-bind="html:name"></a></h1>
                        </li>
                        <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
                    </ul>
                    <section class="top-bar-section">
                        <ul class="right">
                            <li class="divider"></li>
                            <li class="has-dropdown">
                                <a href="#">heolaps</a>
                                <ul class="dropdown">
                                    <li><a href="#">yes yes</a></li>
                                    <li><a href="#">yes yes</a></li>
                                    <li><a href="#">yes yes</a></li>
                                </ul>
                            </li>
                            <li class="divider"></li>
                            <li class="has-form action-icon">
                                <i data-bind="click:$parent.deleteWidget" class="general foundicon-remove"></i>
                            </li>
                            <li class="divider"></li>
                            <li class="has-form action-icon">
                                <i data-bind="click:editWidget" class="general foundicon-edit"></i>
                            </li>
                        </ul>
                        <ul class="left">
                        </ul>

                    </section>
                </nav>
                <!-- ko template: contentTemplate() -->
                <!-- /ko -->
            </div>
        </li>
    </script>
    <script type="text/html" id="line-content-template">
        <div data-bind="attr :{id: widgetContentId}" class="widget-content">
            <svg></svg>
        </div>
    </script>
    <script type="text/html" id="pie-content-template">
        <div class="row">
            <div class="small-12 columns" style="position:relative">
                <div data-bind="attr :{id: widgetContentId}" class="widget-content">
                </div>
                <select style="position:absolute; right: 0.9rem;top: -.09rem;width:auto" data-bind="options:pieKeys, value:selectedPieKey, visible:pieKeys().length > 1"></select>
            </div>
        </div>
        
    </script>
    <script type="text/html" id="segment-template">
    
        <div class="row">
            <div class="large-12 columns">
                <!-- ko template: {name: 'selection-template', data: selection} -->
                <!-- /ko -->
                <!-- ko template: {name: 'group-template', data: group} -->
                <!-- /ko -->

                <ul class="small-block-grid-3 segment-type" data-bind="visible: $root.newWidget">
                    <li>
                        <span class="label radius" data-bind="css: {'primary': chartType() === 'line','secondary': chartType() !== 'line'},click:setChartType.bind(this, 'line')">
                            <i class="general foundicon-plus"></i>
                            <p>LineChart</p>
                        </span>
                    </li>
                    <li>
                        <span class="label radius" data-bind="css: {'primary': chartType() === 'pie','secondary': chartType() !== 'pie'},click:setChartType.bind(this, 'pie')">
                            <i class="general foundicon-plus"></i>
                            <p>PieChart</p>
                        </span>
                    </li>
                    <li>
                        <span class="label radius secondary">
                            <i class="general foundicon-plus"></i>
                            <p>PieChart</p>
                        </span>
                    </li>
                </ul>

                <!-- ko template: {name : 'datagroup-template', data : dataGroup} -->
                <!-- /ko -->
            </div>
        </div>

    </script>
    <script type="text/html" id="selection-template">
        <div class="row">
            <div class="large-12 columns">
                <fieldset>
                    <legend>Selections 
                    <span class="label" data-bind="click: addSimpleSelection"><i class="general foundicon-plus"></i>Simple</span>&nbsp;
                    <span class="label success" data-bind="click: addComplexSelection"><i class="general foundicon-plus"></i>Complex</span>
                    </legend>

                    <ul class="small-block-grid-3" data-bind="foreach: props">
                        <li>
                            <div class="row collapse">
                                <div class="small-10 columns">
                                    <select data-bind="options: $parents[1].properties, value:prop"></select>
                                </div>
                                <div class="small-2 columns">
                                    <i class="general foundicon-remove remove-condition" data-bind="click:$parent.removeSimpleSelection"></i>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <!-- ko template: {name: 'group-template', foreach: complexGroups} -->
                    <!-- /ko -->
                </fieldset>
            </div>
        </div>
    </script>
     <script type="text/html" id="basic-datagroup-template">
        <div class="row">
            <div class="small-12 columns">
                <fieldset>
                    <legend>Grouping Data</legend>
                    <form>
                        
                    </form>
                </fieldset>
            </div>
        </div>
    </script>
    <script type="text/html" id="datagroup-template">
        <div class="row">
            <div class="small-12 columns">
                <fieldset>
                    <legend>Grouping</legend>
                    <form>
                        <!-- ko if:$parent.chartType() === 'pie' -->
                        <div class="row">
                            <div class="small-4 columns">
                                <select data-bind="value:groupBy">
                                <option value="sumBy">Sum By</option>
                                <option value="countBy">Count By</option>
                                <option value="count">Compare Counts</option>
                                <option value="sum">Compare Sum</option>
                                </select>
                            </div>
                            <div class="small-8 columns">
                                <select data-bind="options:$parent.properties, value:groupByProp, visible:hasGrouping"></select>
                            </div>
                        </div>
                        <!-- /ko -->
                        <!-- ko if:$parent.chartType() === 'line' -->
                        <div class="row">
                            <div class="small-8">
                                <div class="row">
                                    <div class="small-4 columns">
                                        <label class="right inline">x Axis</label>
                                    </div>
                                    <div class="small-8 columns">
                                        <select data-bind="options:$parent.properties, value:xAxisProp"></select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="small-4 columns">
                                        <label class="right inline">
                                            <input type="checkbox" data-bind="checked:hasGrouping" />
                                            &nbsp;Group by</label>
                                    </div>
                                    <div class="small-8 columns">
                                        <select data-bind="options:$parent.properties, visible:hasGrouping, value:groupByProp"></select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="small-4 columns">
                                        <label class="right inline">
                                            <input type="checkbox" data-bind="checked:timeseries" />
                                            TimeSeries</label>
                                    </div>
                                    <div class="small-8 columns">
                                        <!-- ko if: timeseries -->
                                        <div class="row">
                                            <div class="small-6 columns">
                                                <select data-bind="options:$parent.groupingOptions, value:groupBy"></select>
                                            </div>
                                            <div class="small-6 columns">
                                                <input type="text" data-bind="value:interval" placeholder="Interval" />
                                            </div>
                                        </div>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </form>
                </fieldset>
            </div>
        </div>
    </script>
    <script type="text/html" id="group-template">
        <div class="row collapse" style="position: relative">
            <!-- ko if: $parent.groups-->
            <div class="columns logic-toggler">
                <div class="logic-wrapper" data-bind="visible: !amIFirst()">
                    <span data-bind="text: logic" class="logic-text label secondary"></span>
                    <select class="logic-selection" data-bind="options:(groupType === 'conditions')?$parents[level].logics : $parents[level].arithmeticOperations, optionsCaption:'logic', value: logic"></select>
                </div>
            </div>
            <!-- /ko -->
            <div data-bind="css: ($parent.groups) ? 'operation-group columns' : 'small-12 columns'">
                <!-- ko if: !editMode() -->
                <div class="condition-view">
                    <span class="keystroke" data-bind="text:expression,click: expand"></span>
                </div>
                <!-- /ko -->
                <!-- ko if: editMode() -->
                <fieldset class="segment">
                    <legend>
                        <span data-bind="text: groupTypeName"></span>
                        <span class="label" data-bind="click: addGroup"><i class="general foundicon-plus"></i>Group</span>&nbsp;
                <span class="label success" data-bind="click: addCondition"><i class="general foundicon-plus"></i><span data-bind="text:conditionTypeName"></span></span>
                        <i class="general foundicon-remove remove-group" data-bind="click: $parent.removeGroup, visible : $parent.groups ||  groupType === 'selections'"></i>
                        <i style="color: #d5d5d5" class="general foundicon-up-arrow" data-bind="click: collapse, visible : editMode() && groupType !== 'selections'"></i>
                        <!-- ko if: !$parent.groups && groupType === 'selections' && $parent.conditionType !== 'conditions' -->
                        &nbsp;<input class="input-elem" type="text" data-bind="value:selectionName" placeholder="Selection Name" />
                        <!-- /ko -->

                    </legend>
                    <!-- ko template: {name: getTemplate, foreach: groups} -->
                    <!-- /ko -->
                </fieldset>
                <!-- /ko -->
            </div>
        </div>

    </script>
    <script type="text/html" id="condition-template">
        <div class="row collapse" style="position: relative">
            <i style="position: absolute; right: -17px; top: 8px; color: #d5d5d5" class="general foundicon-up-arrow" data-bind="click: collapse, visible:editMode"></i>
            <div class="columns logic-toggler">
                <div class="logic-wrapper" data-bind="visible: !amIFirst()">
                    <span data-bind="text: logic" class="logic-text label secondary"></span>
                    <select class="logic-selection" data-bind="options:$parents[level].logics, optionsCaption:'logic', value: logic"></select>
                </div>
            </div>
            <div class="operation-group columns">
                <!-- ko if: !editMode() -->
                <div class="condition-view">
                    <span class="keystroke" data-bind="text:expression,click: expand"></span>
                </div>
                <!-- /ko -->

                <!-- ko if: editMode() -->
                <div class="row collapse" data-bind="visible : !isComplex()">
                    <div class="small-5 columns">
                        <select data-bind="options:$parents[level].properties, optionsCaption:'property', value: prop"></select>
                    </div>
                    <div class="small-2 columns">
                        <select style="margin-left: -1px" data-bind="options:$parents[level].conditionalOperations, value: operation"></select>
                    </div>
                    <div class="small-5 columns">
                        <input type="text" style="margin-left: -2px" data-bind="value:value" placeholder="value"></input>
                    </div>
                </div>
                <!-- ko if: isComplex() -->
                <!-- ko template: {name: 'group-template', data: selectionGroup} -->
                <!-- /ko -->
                <!-- /ko -->
                <div class="row collapse">
                    <div class="small-5 columns">
                        <input type="checkbox" data-bind="checked:isComplex" />
                        Complex
                    </div>
                    <!-- ko if: isComplex() -->

                    <div class="small-3 columns">
                        <select data-bind="options:$parents[level].conditionalOperations, optionsCaption:'Operation', value: operation"></select>
                    </div>
                    <div class="small-3 columns">
                        <input type="text" data-bind="value:value" placeholder="custom value" style="margin-left: -1px"></input>
                    </div>
                    <div class="small-1 columns">
                        <i style="color: #ff0000" class="general foundicon-remove remove-condition" data-bind="click:$parent.removeCondition"></i>
                    </div>
                    <!-- /ko -->

                </div>
                <!-- /ko -->
            </div>
        </div>

    </script>

    <script type="text/html" id="operation-template">
        <div class="row collapse">
            <div class="columns logic-toggler">
                <!-- ko if: $parent.groups && $parent.groups.indexOf($data) > 0 -->
                <div class="logic-wrapper">
                    <span data-bind="text: logic" class="logic-text label secondary"></span>
                    <select class="logic-selection" data-bind="options:$parents[level].arithmeticOperations, optionsCaption:'logic', value: logic"></select>
                </div>
                <!-- /ko -->
            </div>
            <div class="operation-group columns">
                <div class="row collapse">
                    <div class="small-10 columns">
                        <select data-bind="options:$parents[level].properties, optionsCaption:'choose Property', value: prop"></select>
                    </div>
                    <div class="small-2 columns">
                        <i class="general foundicon-remove remove-condition" data-bind="click:$parent.removeCondition"></i>
                    </div>
                </div>
            </div>
        </div>
    </script>


    <script type="text/javascript" src="content/js/global.js"></script>
    <script type="text/javascript" src="content/js/lib/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="content/js/lib/jquery-ui-1.10.3.custom.min.js"></script>
    <script src="content/js/lib/d3.v3.js"></script>
    <script src="content/nvd3/core.js"></script>
    <script src="content/nvd3/utils.js"></script>
    <script src="content/nvd3/models/legend.js"></script>
    <script src="content/nvd3/models/line.js"></script>
    <script src="content/nvd3/tooltip.js"></script>
    <script src="content/nvd3/interactiveLayer.js"></script>
    <script src="content/nvd3/models/axis.js"></script>
    <script src="content/nvd3/models/scatter.js"></script>
    <script src="content/nvd3/models/lineChart.js"></script>
     <script src="content/nvd3/models/stackedArea.js"></script>
     <script src="content/nvd3/models/stackedAreaChart.js"></script>
    
    <script src="content/nvd3/models/pie.js"></script>
    <script src="content/nvd3/models/pieChart.js"></script>

    <script type="text/javascript" src="content/js/sortable.js"></script>
    <script type="text/javascript" src="content/js/lib/knockout-2.2.1.js"></script>
    <script type="text/javascript" src="content/js/lib/underscore-min.js"></script>
    <script type="text/javascript" src="content/foundation/js/foundation/foundation.js"></script>
    <script type="text/javascript" src="content/foundation/js/foundation/foundation.topbar.js"></script>
    <script type="text/javascript" src="content/js/segment2.js"></script>
    <script type="text/javascript" src="content/js/dashboard.js"></script>

    <script type="text/javascript" src="content/js/d3.line.js"></script>
    <script type="text/javascript" src="content/js/pie.js"></script>
    <script type="text/javascript">
        (function (root, $) {
            window.dashboard = new Dashboard();
            ko.applyBindings(dashboard, document.getElementById('dashboard'));
            window.topBar = new TopBar();
            ko.applyBindings(topBar, document.getElementById('topbar'));

            window.widgetProcessor = new WidgetProcessor();
            ko.applyBindings(widgetProcessor, document.getElementById('graphBuilder'));
            $(document).foundation();
        })(this, jQuery);
    </script>
</body>
</html>
