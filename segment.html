<!DOCTYPE html>
<meta charset="utf-8">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>

    <link rel="stylesheet" type="text/css" href="content/style/core/normalize.css" />
    <link rel="stylesheet" type="text/css" href="content/style/core/foundation.css" />
</head>
<body>
    <div id="segment">
        <div class="row">
            <div class="small-3 columns">
                <button data-bind="click: processConditionsSection" class="button">Process Conditions</button>
            </div>
            <div class="small-3 columns">
                <button data-bind="click: processSelectionsSection" class="button">Process Selections</button>
            </div>
            
        </div>
        <div class="row">
            <div class="small-12 columns">
            <button class="button tiny" data-bind="click: addSelectionGroup">Add Selection Group</button>    
            </div>
            
        </div>
        <div class="row">
            <div class="small-12 columns">
        <ul class="small-block-grid-1" data-bind="template: {name: 'group-template', foreach: selectionGroups}">
            
        </ul>
    </div></div>
    <div class="row">
            <div class="small-12 columns">
        <ul class="small-block-grid-1" data-bind="template: {name: 'group-template', data: group}">
            
        </ul>
        </div></div>

        <div class="row">
            <div class="small-4 columns">
                <textarea style="height:300px" data-bind="text:jsonFormattedGroups"></textarea>        
            </div>
            <div class="small-4 columns">
                <textarea style="height:300px" data-bind="text:jsonFormattedInput"></textarea>        
            </div>
            <div class="small-4 columns">
                <textarea style="height:300px" data-bind="text:jsonFormattedOutput"></textarea>        
            </div>
        </div>
    </div>
    <script type="text/html" id="group-template">    
        <li>
            <fieldset>
                <legend>
                <!-- ko if: ($parent.groups && $parent.groups().indexOf($data) > 0) || ($parent.conditions && $parent.conditions().length > 0)-->
                    <select style="width:auto" data-bind="options:(groupType === 'conditions')? $root.logics :$root.arithmeticOperations, optionsCaption:'logic', value: logic"></select> &nbsp;
                <!-- /ko -->
                
                <span data-bind="text: groupTypeName"></span>
                
                <button class="button tiny" data-bind="click: addGroup">Add Group</button>&nbsp;
                                    
                <button class="button tiny" data-bind="click: addCondition, text: conditionTypeName"></button>&nbsp;
                
                <!-- ko if: $parent.groups ||  groupType === 'selections'-->
                <button class="button tiny secondary" data-bind="click: $parent.removeGroup">Remove Group</button>
                <!-- /ko -->
                <!-- ko if: !$parent.groups && groupType === 'selections'-->
                &nbsp;<input style="width:100px;display:inline" type="text" data-bind="value:selectionName" placeholder="Selection Name"/>
                <!-- /ko -->
                </legend>
                <!-- ko if:  $data.conditions().length > 0 -->
                <fieldset>
                    <legend>Conditions</legend>
                    <ul class="small-block-grid-1" data-bind="template: {name: conditionTemplate, foreach: conditions}">
                    </ul>
                </fieldset>
                <!-- /ko -->
                <ul class="small-block-grid-1" data-bind="template: {name: 'group-template', foreach: groups}"></ul>
             </fieldset>
        </li>
    </script>
    <script type="text/html" id="condition-template">
        <li>
            <div class="row">
                <div class="large-1 columns">
                    <!-- ko if: $parent.conditions && $parent.conditions.indexOf($data) > 0 -->
                    <select data-bind="options:$root.logics, optionsCaption:'logic', value: logic"></select>
                    <!-- /ko --> &nbsp;
                </div>
                <div class="large-2 columns">
                    <input type="checkbox" data-bind="checked:isComplex"/> Complex Type
                </div>
                <div class="large-6 columns">
                    <!-- ko if: !isComplex() -->
                    <select data-bind="options:$root.properties, optionsCaption:'choose Property', value: prop"></select>
                    <!-- /ko -->
                    <!-- ko if: isComplex() -->
                    <ul class="small-block-grid-1" data-bind="template: {name: 'group-template', foreach: selectionGroup}">
                    </ul>
                    <!-- /ko -->
                </div>
                <div class="large-1 columns">
                    <select data-bind="options:$root.conditionalOperations, optionsCaption:'Operation', value: operation"></select>
                </div>
                <div class="large-1 columns">
                    <input type="text" data-bind="value:value"></input>
                </div>
                <div class="large-1 columns">
                    <button data-bind="click:$parent.removeCondition" class="button tiny">Remove</button>
                </div>
            </div>
        </li>
    </script>
    
    <script type="text/html" id="operation-template">
        <li>
            <div class="row">
                <div class="large-4 columns">
                    <!-- ko if: $parent.conditions && $parent.conditions.indexOf($data) > 0 -->
                    <select data-bind="options:$root.arithmeticOperations, optionsCaption:'logic', value: logic"></select>
                    <!-- /ko --> &nbsp;
                </div>
                <div class="large-5 columns">
                    <select data-bind="options:$root.properties, optionsCaption:'choose Property', value: prop"></select>
                </div>
                
                <div class="large-3 columns">
                    <button data-bind="click:$parent.removeCondition" class="button tiny">Remove</button>
                </div>
            </div>
        </li>
    </script>
    
    <script type="text/javascript" src="content/js/global.js"></script>
    <script type="text/javascript" src="content/js/lib/knockout-2.2.1.js"></script>
    <script type="text/javascript" src="content/js/lib/underscore-min.js"></script>
    <script type="text/javascript" src="content/js/segment.js"></script>
    <script type="text/javascript">
        (function (root) {
            window.segment = new Segmentor();
            ko.applyBindings(window.segment, document.getElementById('segment'));
        })(this);
    </script>
</body>
</html>
