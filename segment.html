<!DOCTYPE html>
<meta charset="utf-8">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>

    <link rel="stylesheet" type="text/css" href="content/style/core/normalize.css" />
    <link rel="stylesheet" type="text/css" href="content/style/core/foundation.css" />
    <link rel="stylesheet" type="text/css" href="content/style/core/general_foundicons.css" />
    <link href="content/nvd3/nv.d3.css" rel="stylesheet" type="text/css"/>
    <style>
        
        .logic-text {
            position: relative;
            top: .4rem;
            left:1.5rem;
            display: inline;
        }
        .logic-selection{
            display:none;
            max-width: 55px;
            margin-left: 0.8rem;
        }
        .logic-wrapper{
            border-bottom: 1px solid #ddd;
        }
        .row .columns.logic-toggler{
            position:absolute;
            width:80px;
            z-index: 999;
        }
        .row .columns.operation-group{
            padding-left:80px;
        }
        .logic-toggler:hover .logic-wrapper{
            border:none;
        }
        .logic-toggler:hover .logic-text{
            display: none;
        }
        .logic-toggler:hover .logic-selection{
            display: block;
        }
        .remove-group {
            color: #ff0000;
            vertical-align: middle;
        }
        .remove-condition{
            color: #ff0000;
            position: relative;
            top: .4rem;
            left: .5rem;
        }
        .vertical-bg{
            background-image: url('content/images/border_1x1.png');
            background-repeat: repeat-x;
            background-position: 0 20px;
        }
        .condition-view{
            position:relative;
            top:.5rem;
            margin-bottom: 1.5rem;
        }
        .graph {
            height:500px;
        }

    </style>
</head>
<body>
    <div>
        <div class="row" id="segmentProcessor">
            <div class="large-6 columns">
                <div class="row">
                    <div class="small-12 columns">
                        <div id="graph" class="graph">
                            <svg></svg>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="small-6 columns">
                        <button data-bind="click: processDataGroups" class="button small">Groups</button>
                        <button data-bind="click: toggleSegmentDisplay" class="button small">toggle</button>
                    </div>
                    <div class="small-6 columns">
                        <button data-bind="click: processConditionsSection" class="button small">Conditions</button>
                    </div>
                </div>
                <div class="row">
                    <div class="large-12 columns">
                        <h6>Input</h6>
                        <textarea style="height:300px" data-bind="text:rawData"></textarea>
                        <h6>Filtered data</h6>
                        <textarea style="height:300px" data-bind="value:filteredData"></textarea>
                        <h6>Output</h6>
                        <textarea style="height:300px" data-bind="text:outputData"></textarea>
                    </div>
                </div>
            </div>
            <div class="large-6 columns">
                <!-- ko template: {name: 'segment-template', data: segment} -->
                <!-- /ko -->
            </div>
        </div>
    </div>

    <script type="text/html" id="segment-template">
        <div class="row">
            <div class="large-12 columns">
                <!-- ko template: {name: 'selection-template', data: selection} -->
                <!-- /ko -->
                <!-- ko template: {name: 'group-template', data: group} -->
                <!-- /ko -->
                <!-- ko template: {name : 'datagroup-template', data : dataGroup} -->
                <!-- /ko -->
            </div>
        </div>
    </script>

    <script type="text/html" id="selection-template">
        <div class="row">
            <div class="large-12 columns">
                <fieldset>
                    <legend>Selections 
                    <span class="label" data-bind="click: addSimpleSelection"><i class="general foundicon-plus"></i> Simple</span>&nbsp;
                    <span class="label success" data-bind="click: addComplexSelection"><i class="general foundicon-plus"></i> Complex</span>
                    </legend>
                    
                    <ul class="small-block-grid-3" data-bind="foreach: props">
                        <li>
                            <div class="row collapse">
                                <div class="small-10 columns">
                                     <select data-bind="options: $parents[1].properties, value:prop"></select>
                                </div>
                                <div class="small-2 columns">
                                    <i class="general foundicon-remove remove-condition" data-bind="click:$parent.removeSimpleSelection"></i>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <!-- ko template: {name: 'group-template', foreach: complexGroups} -->
                    <!-- /ko -->
                </fieldset>
            </div>
        </div>
    </script>
    
    <script type="text/html" id="datagroup-template">
        <div class="row">
            <div class="small-12 columns">
                <fieldset>
                    <legend>Grouping</legend>
                    <form>
                        <div class="row">
                            <div class="small-8">
                                <div class="row">
                                    <div class="small-4 columns">
                                        <label class="right inline">x Axis</label>
                                    </div>
                                    <div class="small-8 columns">
                                        <select data-bind="options:$parent.properties, value:xAxisProp"></select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="small-4 columns">
                                        <label class="right inline"><input type="checkbox" data-bind="checked:hasGrouping"/> &nbsp;Group by</label>
                                    </div>
                                    <div class="small-8 columns">
                                        <select data-bind="options:$parent.properties, visible:hasGrouping, value:groupByProp"></select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="small-4 columns">
                                        <label class="right inline"><input type="checkbox" data-bind="checked:timeseries"/> TimeSeries</label>
                                    </div>
                                    <div class="small-8 columns">
                                        <!-- ko if: timeseries -->
                                        <div class="row">
                                            <div class="small-6 columns">
                                                <select data-bind="options:$parent.groupingOptions, value:groupBy"></select>
                                            </div>
                                            <div class="small-6 columns">
                                                <input type="text" data-bind="value:interval" placeholder="Interval"/>
                                            </div>
                                        </div>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </fieldset>
            </div>
        </div>
    </script>
    <script type="text/html" id="group-template">
        
        <div class="row collapse" style="position:relative">
        <!-- ko if: $parent.groups-->
        <div class="columns logic-toggler">
            <div class="logic-wrapper" data-bind="visible: !amIFirst()">
                <span data-bind="text: logic" class="logic-text label secondary"></span>
            <select class="logic-selection" data-bind="options:(groupType === 'conditions')?$parents[level].logics : $parents[level].arithmeticOperations, optionsCaption:'logic', value: logic"></select>
            </div>
        </div>
         <!-- /ko -->
        <div data-bind="css: ($parent.groups) ? 'operation-group columns' : 'small-12 columns'">
            <!-- ko if: !editMode() -->
            <div class="condition-view">
                <span class="keystroke" data-bind="text:expression,click: expand"></span>
            </div>
            <!-- /ko -->
            <!-- ko if: editMode() -->
            <fieldset class="segment">
                <legend>
                <span data-bind="text: groupTypeName"></span>
                <span class="label" data-bind="click: addGroup"><i class="general foundicon-plus"></i> Group</span>&nbsp;
                <span class="label success" data-bind="click: addCondition"><i class="general foundicon-plus"></i> <span data-bind="text:conditionTypeName"></span></span>
                <i class="general foundicon-remove remove-group" data-bind="click: $parent.removeGroup, visible : $parent.groups ||  groupType === 'selections'"></i>
                <i style="color: #d5d5d5" class="general foundicon-up-arrow" data-bind="click: collapse, visible : editMode() && groupType !== 'selections'"></i>
                <!-- ko if: !$parent.groups && groupType === 'selections' && $parent.conditionType !== 'conditions' -->
                &nbsp;<input class="input-elem" type="text" data-bind="value:selectionName" placeholder="Selection Name"/>
                <!-- /ko -->
                
                </legend>
                <!-- ko template: {name: getTemplate, foreach: groups} -->
                <!-- /ko -->
             </fieldset>
             <!-- /ko -->
             </div>
        </div>
        
    </script>
    <script type="text/html" id="condition-template">
        <div class="row collapse" style="position:relative">
            <i style="position:absolute;right: -17px;top: 8px; color: #d5d5d5" class="general foundicon-up-arrow" data-bind="click: collapse, visible:editMode"></i>
            <div class="columns logic-toggler">
                <div class="logic-wrapper" data-bind="visible: !amIFirst()">
                    <span data-bind="text: logic" class="logic-text label secondary"></span>
                    <select class="logic-selection" data-bind="options:$parents[level].logics, optionsCaption:'logic', value: logic"></select>
                </div>
            </div>
            <div class="operation-group columns">
                <!-- ko if: !editMode() -->
                <div class="condition-view">
                <span class="keystroke" data-bind="text:expression,click: expand"></span>
                </div>
                <!-- /ko -->

                <!-- ko if: editMode() -->
                <div class="row collapse" data-bind="visible : !isComplex()">
                    <div class="small-5 columns">
                        <select data-bind="options:$parents[level].properties, optionsCaption:'property', value: prop"></select>
                    </div>
                    <div class="small-2 columns">
                        <select style="margin-left:-1px" data-bind="options:$parents[level].conditionalOperations, value: operation"></select>
                    </div>
                    <div class="small-5 columns">
                        <input type="text" style="margin-left:-2px" data-bind="value:value" placeholder="value"></input>
                    </div>
                </div>
                <!-- ko if: isComplex() -->
                <!-- ko template: {name: 'group-template', data: selectionGroup} -->
                <!-- /ko -->
                <!-- /ko -->
                <div class="row collapse">
                    <div class="small-5 columns">
                        <input type="checkbox" data-bind="checked:isComplex"/> Complex
                    </div>
                    <!-- ko if: isComplex() -->
                    
                    <div class="small-3 columns">
                        <select data-bind="options:$parents[level].conditionalOperations, optionsCaption:'Operation', value: operation"></select>
                    </div>
                    <div class="small-3 columns">
                        <input type="text" data-bind="value:value" placeholder="custom value" style="margin-left:-1px"></input>
                    </div>
                    
                    <!-- /ko -->
                    <div class="small-1 columns">
                        <i style="color:#ff0000" class="general foundicon-remove remove-condition" data-bind="click:$parent.removeCondition"></i>
                    </div>
                </div>
                <!-- /ko -->
            </div>
        </div>
        
    </script>
    
    <script type="text/html" id="operation-template">
        <div class="row collapse">
            <div class="columns logic-toggler">
                <!-- ko if: $parent.groups && $parent.groups.indexOf($data) > 0 -->
                <div class="logic-wrapper">
                    <span data-bind="text: logic" class="logic-text label secondary"></span>
                    <select class="logic-selection" data-bind="options:$parents[level].arithmeticOperations, optionsCaption:'logic', value: logic"></select>
                </div>
                <!-- /ko -->
            </div>
            <div class="operation-group columns">
                <div class="row collapse">
                    <div class="small-10 columns">
                        <select data-bind="options:$parents[level].properties, optionsCaption:'choose Property', value: prop"></select>
                    </div>
                    <div class="small-2 columns">
                        <i class="general foundicon-remove remove-condition" data-bind="click:$parent.removeCondition"></i>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script type="text/javascript" src="content/js/lib/jquery-1.10.2.min.js"></script>
    
    <script src="content/js/lib/d3.v3.js"></script>
    <script src="content/nvd3/core.js"></script>
    <script src="content/nvd3/utils.js"></script>
    <script src="content/nvd3/models/legend.js"></script>
    <script src="content/nvd3/models/line.js"></script>
    <script src="content/nvd3/tooltip.js"></script>
    <script src="content/nvd3/interactiveLayer.js"></script>
    <script src="content/nvd3/models/axis.js"></script>
    <script src="content/nvd3/models/scatter.js"></script>
    <script src="content/nvd3/models/lineChart.js"></script>
    
    <script src="content/nvd3/models/pie.js"></script>
    <script src="content/nvd3/models/pieChart.js"></script>

    <script type="text/javascript" src="content/js/global.js"></script>
    <script type="text/javascript" src="content/js/lib/knockout-2.2.1.js"></script>
    <script type="text/javascript" src="content/js/lib/underscore-min.js"></script>
    <script type="text/javascript" src="content/js/segment2.js"></script>
     <script type="text/javascript" src="content/js/segmentprocessor.js"></script>
    <script type="text/javascript">
        (function (root) {
            window.segmentProcessor = new SegmentProcessor();
            ko.applyBindings(window.segmentProcessor, document.getElementById('segmentProcessor'));
        })(this);
    </script>
</body>
</html>
