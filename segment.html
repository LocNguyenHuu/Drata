<!DOCTYPE html>
<meta charset="utf-8">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>

    <link rel="stylesheet" type="text/css" href="content/style/core/normalize.css" />
    <link rel="stylesheet" type="text/css" href="content/style/core/foundation.css" />
    <link rel="stylesheet" type="text/css" href="content/style/core/general_foundicons.css" />
    <style>
    .simple-selection-remove {
        text-align: right;
        padding-top: 5px;
        color:red;
    }
    </style>
</head>
<body>
    <div id="segment">
    
        <!-- <div class="row">
            <div class="small-3 columns">
                <button data-bind="click: processConditionsSection" class="button small">Process Conditions</button>
            </div>
            <div class="small-3 columns">
                <button data-bind="click: processSelectionsSection" class="button small">Process Selections</button>
            </div>
            <div class="small-3 columns">
                
            </div>
        </div> -->
        
        <div class="row">
            <div class="large-8 columns">
                <!-- ko template: {name: 'selection-template', data: selection} -->
                <!-- /ko -->
                <!-- ko template: {name: 'group-template', data: group} -->
                <!-- /ko -->
                <!-- ko template: {name : 'datagroup-template', data : dataGroup} -->
                <!-- /ko -->
            </div>
            <!-- <div class="large-4 columns">
                <button data-bind="click: processDataGroups" class="button small">Process Groups</button>
                <h6>Input</h6>
                <textarea style="height:300px" data-bind="text:rawData"></textarea>  
                <h6>Filtered data</h6>
                <textarea style="height:300px" data-bind="value:filteredData"></textarea>
                <h6>Output</h6>
                <textarea style="height:300px" data-bind="text:outputData"></textarea>
                <h6>group</h6>
                <textarea style="height:300px" data-bind="text:groupData"></textarea>
            </div> -->
        </div>
    </div>
    <script type="text/html" id="selection-template">
        <div class="row">
            <div class="large-12 columns">
                <fieldset class="segment">
                    <legend>Selections 
                    <span class="label" data-bind="click: addSimpleSelection"><i class="general foundicon-plus"></i> Simple</span>&nbsp;
                    <span class="label success" data-bind="click: addComplexSelection"><i class="general foundicon-plus"></i> Complex</span>&nbsp;</legend>
                    
                    <ul class="small-block-grid-3" data-bind="foreach: props">
                        <li>
                            <div class="row collapse">
                                <div class="small-10 columns">
                                     <select data-bind="options: $parents[1].properties, value:prop"></select>
                                </div>
                                <div class="small-2 columns simple-selection-remove">
                                    <i class="general foundicon-remove" data-bind="click:$parent.removeSimpleSelection"></i>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <!-- ko template: {name: 'group-template', foreach: complexGroups} -->
                    <!-- /ko -->
                </fieldset>
            </div>
        </div>
    </script>
    
    <script type="text/html" id="datagroup-template">
    <div class="row">
            <div class="small-12 columns">
        <fieldset class="segment">
            <legend>Grouping</legend>
            <form>
                <div class="row">
                    <div class="small-8">
                        <div class="row">
                            <div class="small-4 columns">
                                <label class="right inline"><input type="checkbox" data-bind="checked:hasGrouping"/> &nbsp;Group by</label>
                            </div>
                            <div class="small-8 columns">
                                <select data-bind="options:$parent.properties, visible:hasGrouping, value:groupByProp"></select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="small-4 columns">
                                <label class="right inline">TimeSeries</label>
                            </div>
                            <div class="small-8 columns">
                                <input type="checkbox" data-bind="checked:timeseries"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="small-4 columns">
                                <!-- ko if: !timeseries() -->
                                <label class="right inline">x Axis</label>
                                <!-- /ko -->
                                <!-- ko if: timeseries -->
                                <select data-bind="options:$parent.groupingOptions, value:groupBy"></select>
                                <!-- /ko -->
                            </div>
                            <div class="small-8 columns">
                                <div class="row">
                                    <div class="small-6 columns">
                                        <select data-bind="options:$parent.properties, value:xAxisProp"></select>
                                    </div>
                                    <!-- ko if: timeseries -->
                                    <div class="small-6 columns">
                                        <input type="text" data-bind="value:interval" placeholder="Interval"/>
                                    </div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </fieldset>
        </div>
        </div>
    </script>
    <script type="text/html" id="group-template">
    
        <div class="row">
        <!-- ko if: ($parent.groups && $parent.groups().indexOf($data) > 0) || ($parent.conditions && $parent.conditions().length > 0)-->
        <div class="small-2 columns">
            <select data-bind="options:(groupType === 'conditions')?$parents[level].logics : $parents[level].arithmeticOperations, optionsCaption:'logic', value: logic"></select>
        </div>
         <!-- /ko -->
        <div data-bind="css: ($parent.groups && $parent.groups().indexOf($data) > 0) || ($parent.conditions && $parent.conditions().length > 0) ? 'small-10 columns' : 'small-12 columns'">
            <fieldset class="segment">
                <legend>
                <span data-bind="text: groupTypeName"></span>
                
                <span class="label" data-bind="click: addGroup"><i class="general foundicon-plus"></i> Group</span>&nbsp;
                                    
                <span class="label success" data-bind="click: addCondition"><i class="general foundicon-plus"></i> <span data-bind="text:conditionTypeName"></span></span>&nbsp;
                
                <!-- ko if: !$parent.groups && groupType === 'selections'-->
                &nbsp;<input style="width:120px;display:inline" type="text" data-bind="value:selectionName" placeholder="Selection Name"/>
                <!-- /ko -->
                <!-- ko if: $parent.groups ||  groupType === 'selections'-->
                <i class="general foundicon-remove" style="color:red" data-bind="click: $parent.removeGroup"></i>
                <!-- /ko -->
                </legend>
                <!-- ko if:  $data.conditions().length > 0 -->
               
                <!-- ko template: {name: conditionTemplate, foreach: conditions} -->
                <!-- /ko -->
               
                <!-- /ko -->
                <!-- ko template: {name: 'group-template', foreach: groups} -->
                <!-- /ko -->
             </fieldset>
             </div>
        </div>
        
    </script>
    <script type="text/html" id="condition-template">
        <div class="row">
            <div class="small-2 columns">
                <!-- ko if: $parent.conditions && $parent.conditions.indexOf($data) > 0 -->
                <select data-bind="options:$parents[level].logics, optionsCaption:'logic', value: logic"></select>
                <!-- /ko -->
                <!-- ko if: !($parent.conditions && $parent.conditions.indexOf($data) > 0) -->
                <h6>Conditions</h6>
                <!-- /ko -->
            </div>
            <div class="small-10 columns">
                <!-- ko if: !isComplex() -->
                <select data-bind="options:$parents[level].properties, optionsCaption:'choose Property', value: prop"></select>
                <!-- /ko -->
                <!-- ko if: isComplex() -->
                    <!-- ko template: {name: 'group-template', foreach: selectionGroup} -->
                    <!-- /ko -->
                <!-- /ko -->
                <div class="row">
                    <div class="small-3 columns">
                        <input type="checkbox" data-bind="checked:isComplex"/> Complex
                    </div>
                    <div class="small-3 columns">
                        <select data-bind="options:$parents[level].conditionalOperations, optionsCaption:'Operation', value: operation"></select>
                    </div>
                    <div class="small-4 columns">
                        <input type="text" data-bind="value:value" placeholder="custom value"></input>
                    </div>
                    <div class="small-2 columns">
                        <i style="color:#ff0000" class="general foundicon-remove" data-bind="click:$parent.removeCondition"></i>
                    </div>
                </div>
            </div>
        </div>
        
    </script>
    
    <script type="text/html" id="operation-template">
        <div class="row">
            <div class="small-2 columns">
                <!-- ko if: $parent.conditions && $parent.conditions.indexOf($data) > 0 -->
                <select data-bind="options:$parents[level].arithmeticOperations, optionsCaption:'logic', value: logic"></select>
                <!-- /ko -->
            </div>
            <div class="small-10 columns">
                <div class="row">
                    <div class="small-9 columns">
                        <select data-bind="options:$parents[level].properties, optionsCaption:'choose Property', value: prop"></select>
                    </div>
                    
                    <div class="small-3 columns">
                        <i style="color:#ff0000" class="general foundicon-remove" data-bind="click:$parent.removeCondition"></i>
                    </div>
                </div>
            </div>
        </div>
    </script>
    
    <script type="text/javascript" src="content/js/global.js"></script>
    <script type="text/javascript" src="content/js/lib/knockout-2.2.1.js"></script>
    <script type="text/javascript" src="content/js/lib/underscore-min.js"></script>
    <script type="text/javascript" src="content/js/segment.js"></script>
    <script type="text/javascript">
        (function (root) {
            var model = {
                properties: ['a', 'b', 'c', 'timestamp'],
                selection: {
                    complexGroups: [
                        {
                            conditions: [
                                {
                                    prop: "a",
                                    logic: "+"
                                },
                                {
                                    prop: "b",
                                    logic: "+"
                                }
                            ],
                            logic: "+",
                            groups: [
                                {
                                    conditions: [
                                        {
                                            prop: "a",
                                            logic: "+"
                                        }
                                    ],
                                    logic: "*",
                                    groups: []
                                }
                            ],
                            selectionName: "a+b"
                        }
                    ],
                    props: [
                        {
                            prop: "a"
                        }
                    ]
                },
                dataGroup: {
                    xAxisProp: "timestamp",
                    groupByProp: "c",
                    groupBy: "sumBy",
                    timeseries: true,
                    hasGrouping: true,
                    interval: "5"
                },
                group: {
                    conditions: [
                        {
                            prop: "b",
                            logic: "and",
                            conditionType: "conditions",
                            operation: ">",
                            selectionGroup: {
                                groupType: "selections",
                                conditions: [],
                                logic: "+",
                                groups: []
                            },
                            isComplex: false,
                            value: "5"
                        },
                        {
                            logic: "and",
                            operation: ">",
                            selectionGroup: {
                                conditions: [
                                    {
                                        prop: "a",
                                        logic: "+"
                                        
                                    },
                                    {
                                        prop: "b",
                                        logic: "+"
                                    }
                                ],
                                logic: "+",
                                groups: []
                            },
                            isComplex: true,
                            value: "20"
                        }
                    ],
                    logic: "and",
                    groups: []
                }
            };
            window.segment = new Segmentor(model);
            ko.applyBindings(window.segment, document.getElementById('segment'));
        })(this);
    </script>
</body>
</html>
